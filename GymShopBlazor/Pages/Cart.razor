@page "/cart"

<head>
    <link href="css/cart.css" rel="stylesheet" />
</head>

<div class="shopping-cart">
    <h3>Varukorg</h3>

    @foreach (var item in cartItems)
    {
        <CartItem Item="item" OnQuantityChanged="UpdateQuantity" OnRemove="RemoveItem" />
    }

    @if (cartItems.Count > 0)
    {
        <div class="cart-summary">
            <h4>Totalt ordervärde: @totalPrice.ToString("0.00") SEK</h4>
            @if (!isCheckoutOpen)
            {
                <button class="btn btn-success" @onclick="OpenCheckout">Betala</button>
            }
        </div>
    }
    else
    {
        <p>Din varukorg är tom.</p>
    }
    
    @if (isCheckoutOpen)
    {
        <Checkout/>
    }
</div>

@code {
    private List<DemoItems> cartItems = new()
    {
        new DemoItems { Name = "Löpartröja dam", Category = "Tröja", Price = 299.00, ImageUrl = "https://03.cdn37.se/zY/images/2.2443182/craft-lopartroja-pro-hypervent-tee-2-dam-black.jpeg" },
        new DemoItems { Name = "Träningsbyxor adidas dam", Category = "Byxor", Price = 499.00, ImageUrl = "https://sannadal.com/content/uploads/2022/12/377154_102_ADIDAS_TIRO23-L-TRG-PNT-W.jpg" }
    };

    private double totalPrice;
    private bool isCheckoutOpen = false;

    private void UpdateTotalPrice()
    {
        totalPrice = cartItems.Sum(item => item.Price * item.Quantity);
        StateHasChanged();
    }

    private void UpdateQuantity(int newQuantity)
    {
        UpdateTotalPrice();
        StateHasChanged();
    }

    private void RemoveItem(DemoItems item)
    {
        cartItems.Remove(item);
        UpdateTotalPrice();
        StateHasChanged();
    }

    private void OpenCheckout()
    {
        isCheckoutOpen = !isCheckoutOpen;
    }

    public class DemoItems
    {
        public string Name { get; set; }
        public string Category { get; set; }
        public double Price { get; set; }
        public string ImageUrl { get; set; }
        public int Quantity { get; set; } = 1;
    }
}
